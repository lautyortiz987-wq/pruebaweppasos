<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ENVIOS A TODO EL PAIS</title>
    
    <!-- LIBRERÍAS EXTERNAS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;700;800&display=swap');
        
        :root {
            --brand-color: #3b82f6; 
            --brand-hover: #2563eb;
            --ig-gradient: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            --wa-color: #25d366;
            --bg-color: #050505;
            --text-color: #ffffff;
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.05);
        }

        .light-mode {
            --bg-color: #f8fafc;
            --text-color: #0f172a;
            --card-bg: rgba(15, 23, 42, 0.03);
            --card-border: rgba(15, 23, 42, 0.08);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            scroll-behavior: smooth;
            overflow-x: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.4s ease, color 0.4s ease;
            -webkit-tap-highlight-color: transparent;
        }

        #bg-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }

        .accent-text { color: var(--brand-color); }
        .accent-bg { background-color: var(--brand-color); }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            border-radius: 40px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* ZOOM SYSTEM */
        .zoom-container {
            position: relative;
            overflow: hidden;
            border-radius: 35px;
            cursor: zoom-in;
            background: #111;
            touch-action: none;
        }
        .zoom-image {
            width: 100%; height: 100%; object-fit: cover;
            display: block; transition: transform 0.1s ease-out;
            will-change: transform; transform-origin: center;
        }

        /* HERO CAROUSEL STYLES */
        .hero-slider-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .hero-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            pointer-events: none;
        }
        .hero-slide.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-container {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 92%; max-width: 480px;
            z-index: 1000; padding: 30px;
            border-radius: 40px;
            box-shadow: 0 40px 80px -12px rgba(0,0,0,0.7);
            border: 1px solid rgba(59, 130, 246, 0.2);
            max-height: 85vh; overflow-y: auto;
            visibility: hidden; opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: #0a0a0a;
            color: white;
        }
        .modal-container.active { visibility: visible; opacity: 1; transform: translate(-50%, -50%) scale(1); }

        .overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 900; display: none; opacity: 0;
            transition: opacity 0.3s ease;
        }
        .overlay.active { display: block; opacity: 1; }

        #toast {
            visibility: hidden; min-width: 280px;
            background-color: var(--brand-color); color: white;
            text-align: center; border-radius: 50px;
            padding: 16px; position: fixed; z-index: 2000;
            left: 50%; bottom: 40px; transform: translateX(-50%); 
            font-weight: 800; text-transform: uppercase;
        }
        #toast.show { visibility: visible; animation: toastIn 0.4s, toastOut 0.4s 2.6s; }

        .admin-input {
            width: 100%; padding: 12px 20px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; outline: none; font-weight: bold; color: white;
            margin-bottom: 12px;
        }

        .size-badge {
            padding: 10px 14px; border-radius: 12px;
            border: 1px solid var(--card-border);
            cursor: pointer; font-size: 11px; font-weight: 800;
            transition: all 0.2s; text-align: center;
        }
        .size-badge.selected { background: var(--brand-color); color: white; border-color: var(--brand-color); }

        .whatsapp-float { position: fixed; bottom: 25px; right: 25px; background: var(--wa-color); color: white; width: 54px; height: 54px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 100; transition: transform 0.3s; }
        .ig-float { position: fixed; bottom: 90px; right: 25px; background: var(--ig-gradient); color: white; width: 54px; height: 54px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 100; transition: transform 0.3s; }
        
        .calc-label {
            display: block; font-size: 9px; font-weight: 800; text-transform: uppercase; 
            opacity: 0.4; margin-left: 8px; margin-bottom: 4px;
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 6px;
            overflow: hidden;
        }
        .theme-toggle-dot {
            position: absolute;
            left: 4px;
            width: 22px;
            height: 22px;
            background: var(--brand-color);
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }
        .light-mode .theme-toggle-dot { transform: translateX(30px); }
        .theme-toggle i { font-size: 12px; z-index: 2; color: var(--text-color); opacity: 0.5; }
    </style>
</head>
<body class="theme-dark">

    <canvas id="bg-canvas"></canvas>
    <div id="toast">Notificación</div>
    <div id="modal-overlay" class="overlay"></div>

    <!-- NAVEGACIÓN -->
    <nav class="fixed w-full z-50 transition-all duration-300 h-20 flex items-center px-6" id="navbar">
        <div class="max-w-7xl mx-auto w-full flex justify-between items-center">
            <span class="text-xl font-black tracking-tight uppercase italic cursor-pointer" onclick="window.scrollTo(0,0)">
                envios<span class="accent-text">TODO EL PAIS</span>
            </span>
            
            <div class="flex items-center space-x-4 md:space-x-8">
                <div class="hidden md:flex items-center space-x-8 text-[10px] font-black uppercase tracking-widest">
                    <a href="#inicio" class="hover:accent-text transition-colors">Inicio</a>
                    <a href="#catalogo" class="hover:accent-text transition-colors">Catálogo</a>
                    <a href="#talles-info" class="hover:accent-text transition-colors">Guia De Talles</a>
                </div>

                <!-- Theme Toggle -->
                <div class="theme-toggle" id="theme-switch">
                    <i class="fa-solid fa-moon"></i>
                    <div class="theme-toggle-dot"></div>
                    <i class="fa-solid fa-sun"></i>
                </div>

                <button id="admin-trigger" class="px-4 h-9 flex items-center justify-center rounded-full bg-white/5 border border-white/10 text-[9px] font-black tracking-widest hover:bg-white/10 transition-all uppercase">
                    Panel de Staff
                </button>
            </div>
        </div>
    </nav>

    <!-- HERO (DINÁMICO) -->
    <header id="inicio" class="pt-40 pb-20 relative">
        <div class="max-w-7xl mx-auto px-6 text-center lg:text-left grid lg:grid-cols-2 gap-12 items-center">
            <div>
                <h1 class="text-6xl md:text-[7.5rem] font-black leading-[0.85] uppercase italic tracking-tighter mb-8">
                    PASOS<br><span class="accent-text">URBANOS.</span>
                </h1>
                <p class="opacity-40 mb-10 max-w-sm font-medium text-base mx-auto lg:mx-0 uppercase tracking-tighter">
                    Revendedores oficiales de calzado premium importado directamente desde Brasil. 
                    <span class="accent-text font-black">EL ENVIO QUEDA A CARGO DEL CLIENTE</span> 
                <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                    <a href="#catalogo" class="accent-bg text-white px-10 py-4 rounded-full font-black uppercase text-[10px] tracking-widest inline-block shadow-xl">
                        Ver Catálogo
                    </a>
                    <a href="#talles-info" class="bg-white/5 border border-white/10 px-10 py-4 rounded-full font-black uppercase text-[10px] tracking-widest inline-block">
                        Guía de Talles
                    </a>
                </div>
            </div>
            
            <!-- CONTENEDOR DE CARRUSEL -->
            <div class="relative group">
                <div class="zoom-container shadow-2xl aspect-[4/5] bg-neutral-900" id="hero-slider-wrapper">
                    <div class="hero-slider-container" id="hero-slides-target">
                        <!-- Las imágenes se cargan dinámicamente aquí desde el stock -->
                        <div class="hero-slide active">
                            <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=1000&auto=format&fit=crop" class="zoom-image" alt="Zapatillas">
                        </div>
                    </div>
                </div>
                
                <!-- Indicadores de slide -->
                <div id="hero-dots" class="absolute -bottom-8 left-1/2 -translate-x-1/2 flex gap-2">
                    <div class="w-8 h-1 bg-blue-500 rounded-full"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- CATALOGO -->
    <main id="catalogo" class="py-24">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="text-5xl font-black italic uppercase tracking-tighter mb-16">
                STOCK<br><span class="accent-text">DISPONIBLE</span>
            </h2>
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="col-span-full py-20 text-center opacity-30 font-bold uppercase tracking-widest">
                    <i class="fa-solid fa-spinner fa-spin text-4xl mb-4 block"></i>
                    Cargando stock...
                </div>
            </div>
        </div>
    </main>

    <!-- SECCIÓN TALLES -->
    <section id="talles-info" class="py-24 border-y border-white/5 bg-white/5">
        <div class="max-w-5xl mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-black italic uppercase mb-2">Guía de <span class="accent-text">Talles</span></h2>
                <p class="opacity-40 text-[10px] font-bold uppercase tracking-widest">Atención: Talle Brasil es un número menos que el Argentino</p>
            </div>
            <div class="grid lg:grid-cols-2 gap-12">
                <div class="glass-card p-8">
                    <div class="max-h-[400px] overflow-y-auto">
                        <table class="w-full text-[11px] font-bold uppercase tracking-widest">
                            <thead><tr class="opacity-40 border-b border-white/10"><th class="py-4 text-left">ARGENTINA</th><th class="py-4 text-left">BRASIL (BR)</th><th class="py-4 text-right">CM</th></tr></thead>
                            <tbody class="opacity-70">
                                <tr class="border-b border-white/5"><td class="py-3">36</td><td class="accent-text font-black">35</td><td class="text-right">23.3</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">37</td><td class="accent-text font-black">36</td><td class="text-right">24.0</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">38</td><td class="accent-text font-black">37</td><td class="text-right">24.7</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">39</td><td class="accent-text font-black">38</td><td class="text-right">25.3</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">40</td><td class="accent-text font-black">39</td><td class="text-right">26.0</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">41</td><td class="accent-text font-black">40</td><td class="text-right">26.7</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">42</td><td class="accent-text font-black">41</td><td class="text-right">27.3</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">43</td><td class="accent-text font-black">42</td><td class="text-right">28.0</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">44</td><td class="accent-text font-black">43</td><td class="text-right">28.7</td></tr>
                                <tr class="border-b border-white/5"><td class="py-3">45</td><td class="accent-text font-black">44</td><td class="text-right">29.3</td></tr>
                                <tr><td class="py-3">46</td><td class="accent-text font-black">45</td><td class="text-right">30.0</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="flex flex-col justify-center space-y-6">
                    <div class="p-8 bg-blue-500/5 rounded-[40px] border border-blue-500/10">
                        <p class="text-xs font-bold uppercase italic accent-text mb-3">¿Cómo elegir?</p>
                        <p class="text-[11px] opacity-60 leading-relaxed uppercase mb-4">
                            En el catálogo verás los talles en formato **BR (Brasil)**. Para no equivocarte, simplemente pedí **un número menos** de lo que calzas habitualmente en Argentina.
                        </p>
                        <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl">
                            <div class="text-center">
                                <p class="text-[8px] opacity-40">CALZAS</p>
                                <p class="text-lg font-black">40 ARG</p>
                            </div>
                            <i class="fa-solid fa-arrow-right opacity-20"></i>
                            <div class="text-center">
                                <p class="text-[8px] accent-text">PEDÍ</p>
                                <p class="text-lg font-black accent-text">39 BR</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- MODAL COMPRA (CHECKOUT) -->
    <div id="checkout-panel" class="modal-container">
        <div id="checkout-content">
            <h2 id="checkout-name" class="text-2xl font-black uppercase italic mb-2">Modelo</h2>
            <p id="checkout-price" class="accent-text text-xl font-black mb-6">$0</p>
            
            <span class="calc-label">Selecciona tu talle (BR)</span>
            <div id="checkout-sizes" class="grid grid-cols-4 gap-2 mb-8"></div>
            
            <button id="whatsapp-order-btn" class="w-full bg-green-500 text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest flex items-center justify-center gap-2">
                <i class="fa-brands fa-whatsapp text-lg"></i> Confirmar pedido
            </button>
            <button onclick="UI.close()" class="mt-4 w-full text-[9px] opacity-40 uppercase font-black">Volver</button>
        </div>
    </div>

    <!-- MODAL STAFF -->
    <div id="admin-panel" class="modal-container">
        <div id="login-view">
            <h2 class="text-xl font-black uppercase mb-6 italic text-center">Acceso Staff</h2>
            <input type="password" id="admin-password-input" class="admin-input text-center tracking-[0.5em]" placeholder="CONTRASEÑA">
            <button id="admin-login-btn" class="w-full accent-bg text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest">Ingresar</button>
            <button onclick="UI.close()" class="mt-4 w-full text-[9px] opacity-40 uppercase font-black">Cerrar</button>
        </div>

        <div id="dashboard-view" class="hidden">
            <h2 class="text-xl font-black uppercase mb-6 italic text-center">Cargar Stock</h2>
            <div class="space-y-1">
                <span class="calc-label">Nombre del modelo</span>
                <input type="text" id="p-name" class="admin-input" placeholder="Ej: Nike Jordan Retro">
                
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <div>
                        <span class="calc-label">Costo ($)</span>
                        <input type="number" id="p-cost" class="admin-input" placeholder="0">
                    </div>
                    <div>
                        <span class="calc-label text-blue-400">Ganancia %</span>
                        <input type="number" id="p-margin" class="admin-input" value="100">
                    </div>
                    <div>
                        <span class="calc-label text-green-400">Venta ($)</span>
                        <input type="number" id="p-price" class="admin-input" placeholder="0">
                    </div>
                </div>

                <label class="block text-[10px] uppercase font-black opacity-40 mb-2">Seleccionar Foto</label>
                <input type="file" id="p-img-file" accept="image/*" class="admin-input" style="color:white; padding:10px;">
                
                <span class="calc-label">Talles disponibles (BR)</span>
                <div class="grid grid-cols-5 gap-2 mb-6" id="size-selector">
                    <span class="size-badge" data-size="35">35</span>
                    <span class="size-badge" data-size="36">36</span>
                    <span class="size-badge" data-size="37">37</span>
                    <span class="size-badge" data-size="38">38</span>
                    <span class="size-badge" data-size="39">39</span>
                    <span class="size-badge" data-size="40">40</span>
                    <span class="size-badge" data-size="41">41</span>
                    <span class="size-badge" data-size="42">42</span>
                    <span class="size-badge" data-size="43">43</span>
                    <span class="size-badge" data-size="44">44</span>
                    <span class="size-badge" data-size="45">45</span>
                </div>
                
                <button id="p-save-btn" class="w-full accent-bg text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest mb-2">Publicar Stock</button>
                <button onclick="UI.close()" class="w-full text-[9px] opacity-40 uppercase font-black py-2">Salir</button>
            </div>
        </div>
    </div>

    <!-- BOTONES SOCIALES -->
    <a href="https://www.instagram.com/passos.urbanoss/" target="_blank" class="ig-float"><i class="fa-brands fa-instagram"></i></a>
    <a href="https://wa.me/5491156474987" target="_blank" class="whatsapp-float"><i class="fa-brands fa-whatsapp"></i></a>
    
<script type="module">
    
    const CONFIG = {
        OWNER: 'lautyortiz987-wq',
        REPO: 'oficialpasosurbanos',
        PATH: 'stock.json',
        IMGBB_KEY: 'd4cde83f6e49f61e9940910034f671cf',
        TOKEN: sessionStorage.getItem('gh_token') || "" 
    };
    
    const state = { 
        products: [],
        selectedProduct: null,
        selectedSize: null,
        isLightMode: false,
        currentHeroIndex: 0
    };

    window.deleteProduct = async (event, index) => {
        event.stopPropagation(); 
        const p = state.products[index];
        if (!confirm(`¿Estás seguro de que quieres eliminar "${p.name}"?`)) return;
        const updatedProducts = state.products.filter((_, i) => i !== index);
        const success = await saveToGithub(updatedProducts);
        if (success) {
            state.products = updatedProducts; 
            renderCatalog(); 
            updateHeroCarousel();
            UI.notify("Producto eliminado correctamente");
        }
    };

    async function fetchStock() {
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${CONFIG.OWNER}/${CONFIG.REPO}/main/${CONFIG.PATH}?nocache=${Date.now()}`, {
                cache: "no-store" 
            });
            if (res.ok) {
                state.products = await res.json();
                renderCatalog();
                updateHeroCarousel();
            }
        } catch (e) { console.error("Error al leer stock.json:", e); }
    }
    
    async function saveToGithub(newData) {
        const token = sessionStorage.getItem('gh_token'); 
        if (!token) return false;
        UI.notify("Sincronizando...");
        try {
            const fileRes = await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/${CONFIG.PATH}`, {
                headers: { "Authorization": `token ${token}` }
            });
            const fileData = await fileRes.json();
            const updateRes = await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/${CONFIG.PATH}`, {
                method: "PUT",
                headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: "Update stock",
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(newData, null, 2)))),
                    sha: fileData.sha
                })
            });
            return updateRes.ok;
        } catch (e) { return false; }
    }

    async function uploadImage(file) {
        const formData = new FormData();
        formData.append('image', file);
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${CONFIG.IMGBB_KEY}`, { method: 'POST', body: formData });
        const data = await res.json();
        return data.success ? data.data.url : null;
    }

    window.UI = {
        openModal: (id) => {
            document.getElementById('modal-overlay').classList.add('active');
            document.getElementById(id).classList.add('active');
        },
        close: () => {
            document.querySelectorAll('.modal-container, .overlay').forEach(el => el.classList.remove('active'));
        },
        notify: (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        },
        toggleTheme: () => {
            state.isLightMode = !state.isLightMode;
            document.body.classList.toggle('light-mode', state.isLightMode);
        },
        initZoom: (container) => {
            if(!container) return;
            const img = container.querySelector('img');
            container.onmousemove = (e) => {
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                img.style.transformOrigin = `${x}px ${y}px`;
                img.style.transform = "scale(2.2)";
            };
            container.onmouseleave = () => img.style.transform = "scale(1)";
        },
        openCheckout: (index) => {
            const p = state.products[index];
            state.selectedProduct = p;
            document.getElementById('checkout-name').innerText = p.name;
            document.getElementById('checkout-price').innerText = `$${Number(p.price).toLocaleString()}`;
            document.getElementById('checkout-sizes').innerHTML = p.sizes.map(s => `<span class="size-badge checkout-size" data-size="${s}">${s}</span>`).join('');
            document.querySelectorAll('.checkout-size').forEach(b => {
                b.onclick = () => {
                    document.querySelectorAll('.checkout-size').forEach(x => x.classList.remove('selected'));
                    b.classList.add('selected');
                    state.selectedSize = b.dataset.size;
                };
            });
            UI.openModal('checkout-panel');
        }
    };

    // LÓGICA DEL CARRUSEL HERO DINÁMICO
    function updateHeroCarousel() {
        const container = document.getElementById('hero-slides-target');
        const dots = document.getElementById('hero-dots');
        
        // Tomar los últimos 3 productos para el inicio
        const recentItems = [...state.products].reverse().slice(0, 3);
        
        if (recentItems.length === 0) return;

        container.innerHTML = recentItems.map((p, i) => `
            <div class="hero-slide ${i === 0 ? 'active' : ''}">
                <img src="${p.img}" class="zoom-image" alt="${p.name}">
            </div>
        `).join('');

        dots.innerHTML = recentItems.map((_, i) => `
            <div class="dot h-1 rounded-full transition-all duration-300 ${i === 0 ? 'w-8 bg-blue-500' : 'w-4 bg-white/20'}"></div>
        `).join('');

        // Limpiar intervalo anterior
        clearInterval(window.heroInterval);
        state.currentHeroIndex = 0;

        if (recentItems.length > 1) {
            window.heroInterval = setInterval(() => {
                const slides = document.querySelectorAll('.hero-slide');
                const dotEls = document.querySelectorAll('.dot');
                if (!slides.length) return;

                slides[state.currentHeroIndex].classList.remove('active');
                dotEls[state.currentHeroIndex].classList.replace('w-8', 'w-4');
                dotEls[state.currentHeroIndex].classList.replace('bg-blue-500', 'bg-white/20');
                
                state.currentHeroIndex = (state.currentHeroIndex + 1) % recentItems.length;
                
                slides[state.currentHeroIndex].classList.add('active');
                dotEls[state.currentHeroIndex].classList.replace('w-4', 'w-8');
                dotEls[state.currentHeroIndex].classList.replace('bg-white/20', 'bg-blue-500');
            }, 4000);
        }

        UI.initZoom(document.getElementById('hero-slider-wrapper'));
    }

    document.getElementById('theme-switch').onclick = UI.toggleTheme;
    document.getElementById('admin-trigger').onclick = () => UI.openModal('admin-panel');
    document.getElementById('modal-overlay').onclick = UI.close;

    document.getElementById('admin-login-btn').onclick = () => {
        const inputToken = document.getElementById('admin-password-input').value.trim();
        if(inputToken.startsWith("ghp_")) { 
            sessionStorage.setItem('gh_token', inputToken); 
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('dashboard-view').classList.remove('hidden');
            UI.notify('Staff Conectado');
            renderCatalog();
        } else {
            UI.notify('Token Inválido');
        }
    };

    document.getElementById('p-cost').oninput = document.getElementById('p-margin').oninput = () => {
        const costo = parseFloat(document.getElementById('p-cost').value) || 0;
        const margen = parseFloat(document.getElementById('p-margin').value) || 0;
        document.getElementById('p-price').value = Math.round(costo * (1 + (margen / 100)));
    };

    document.querySelectorAll('#size-selector .size-badge').forEach(b => { b.onclick = () => b.classList.toggle('selected'); });

    document.getElementById('p-save-btn').onclick = async () => {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const fileInput = document.getElementById('p-img-file');
        const sizes = Array.from(document.querySelectorAll('#size-selector .size-badge.selected')).map(s => s.dataset.size);

        if(!name || !price || !fileInput.files[0] || sizes.length === 0) return UI.notify('Faltan datos');

        UI.notify("Subiendo foto...");
        const imgUrl = await uploadImage(fileInput.files[0]);
        if(!imgUrl) return;

        const updatedProducts = [...state.products, { name, price, img: imgUrl, sizes }];
        if(await saveToGithub(updatedProducts)) {
            state.products = updatedProducts;
            renderCatalog();
            updateHeroCarousel();
            UI.close();
            // Limpiar campos
            document.getElementById('p-name').value = "";
            document.getElementById('p-cost').value = "";
            document.getElementById('p-price').value = "";
            fileInput.value = "";
            document.querySelectorAll('#size-selector .size-badge').forEach(b => b.classList.remove('selected'));
        }
    };

    document.getElementById('whatsapp-order-btn').onclick = () => {
        if(!state.selectedSize) return UI.notify('Elige talle');
        window.open(`https://wa.me/5491156474987?text=Hola! Quiero:*${state.selectedProduct.name}* en talle *${state.selectedSize} BR* ($${state.selectedProduct.price})`, '_blank');
    };

    function renderCatalog() {
        const grid = document.getElementById('product-grid');
        const isStaff = sessionStorage.getItem('gh_token') !== null;
        if (state.products.length === 0) {
            grid.innerHTML = `<div class="col-span-full py-20 text-center opacity-30 font-bold uppercase">Sin stock</div>`;
            return;
        }
        grid.innerHTML = state.products.map((p, i) => `
            <div class="glass-card p-6 group relative cursor-pointer">
                ${isStaff ? `<button onclick="deleteProduct(event, ${i})" class="absolute top-4 right-4 z-10 bg-red-500 w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-trash text-[10px]"></i></button>` : ''}
                <div onclick="UI.openCheckout(${i})">
                    <div class="zoom-container aspect-[4/5] mb-5" id="zoom-${i}"><img src="${p.img}" class="zoom-image"></div>
                    <div class="flex justify-between items-start">
                        <div><h3 class="text-lg font-black italic uppercase">${p.name}</h3><p class="accent-text font-black text-xl">$${Number(p.price).toLocaleString()}</p></div>
                        <div class="bg-white/5 p-2 rounded-xl text-[8px] font-black opacity-40">BR</div>
                    </div>
                </div>
            </div>
        `).join('');
        state.products.forEach((_, i) => UI.initZoom(document.getElementById(`zoom-${i}`)));
    }

    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initParticles(); }
    function initParticles() {
        particles = [];
        for(let i=0; i<60; i++) particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, r: Math.random() * 2, v: Math.random() * 0.5 + 0.1 });
    }
    window.onresize = resize; resize();
    function anim() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = state.isLightMode ? "rgba(15,23,42,0.1)" : "rgba(255,255,255,0.2)";
        for(let p of particles) {
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            p.y += p.v; if(p.y > canvas.height) p.y = -10;
        }
        requestAnimationFrame(anim);
    }

    window.onload = () => { anim(); fetchStock(); }
</script>
</body>
</html>


